<html>
	<head>
		<title>Binding Test</title>
		<script language="JavaScript">
			/**
			 * Register Javascript Function 4 BOLT
			 */	
			xlue.registerJavascriptFunction('alert',function(functionName,msg){
				alert("name:"+msg.name);
				return JSON.parse('{"name":"cef"}');
			});

			/**
			 * Handler the Lua Message
			 */	
			xlue.onLuaMessageReceived(function(functionName,msg){
				alert("name:"+msg.name);
				sendMessage();
			});

			/**
			 * Send a message to the brow process.
			 */	
 			function sendMessage() {
			  var msg = document.getElementById("message").value;
			  xlue.sendMessage('binding_test', JSON.parse(msg))
			}

			/**
			 * Call lua function in the borwser process
			 */	
			function callLuaTest(){
				var msg = document.getElementById("message").value;
				xlue.callLuaFunction('testfunc',JSON.parse(msg),function(name,args){
					document.getElementById('result').value = 
						"result from lua: " + args.result;
				});
			}
		</script>

	</head>
	<body>
		<form>
			Message: 
			<input type="text" 
			       id="message" 
				   size="100"
				   value="{&quot;city&quot;:&quot;ShenZhen&quot;,&quot;street&quot;:&quot;Keji Road&quot;,&quot;postcode&quot;:518057}">
			</input>
			<br/>
			
			<input type="button" 
				   size="50" 
				   onclick="sendMessage();" 
				   value="Send Message to Lua">
			</input>
			<br/>
			
			<input type="button" 
				   size="50" 
				   onclick="callLuaTest();" 
				   value="Call Lua Function">
			</input>
			<br/>
			You should see the reverse of your message below:<br/>
			<textarea rows="10" cols="40" id="result">
			</textarea>
		</form>
	</body>
</html>
